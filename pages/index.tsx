import React, { useState, useEffect } from 'react'
import Head from 'next/head'
import { NextPage } from 'next'
import NextLink from 'next/link'
import {
  Card,
  CardContent,
  Grid,
  Typography,
  Link,
  CardActionArea
} from '@mui/material'
import { Pie } from 'react-chartjs-2'
import { Chart as ChartJS, ArcElement, Tooltip, Legend } from 'chart.js'

import { monthNames } from '@/utils/months'
import { pocketApi } from '@/api'

ChartJS.register(ArcElement, Tooltip, Legend)
// Generated by https://quicktype.io

export interface TopLevel {
  amounts: number[]
  categories: string[]
}

const Home: NextPage = () => {
  const [getReportState, setGetReportState] = useState<TopLevel>({
    amounts: [],
    categories: []
  })

  const getReport = async () => {
    const { data } = await pocketApi.post('/bills/report')
    setGetReportState(data)
  }
  useEffect(() => {
    getReport()
  }, [])

  const data = {
    labels: getReportState.categories,
    datasets: [
      {
        // label: '# of Votes',
        data: getReportState.amounts,
        backgroundColor: [
          'rgba(255, 99, 132, 0.2)',
          'rgba(54, 162, 235, 0.2)',
          'rgba(255, 206, 86, 0.2)',
          'rgba(75, 192, 192, 0.2)',
          'rgba(153, 102, 255, 0.2)',
          'rgba(255, 159, 64, 0.2)',
          'rgba(251, 251, 251, 0.2)'
        ],
        borderColor: [
          'rgba(255, 99, 132, 1)',
          'rgba(54, 162, 235, 1)',
          'rgba(255, 206, 86, 1)',
          'rgba(75, 192, 192, 1)',
          'rgba(153, 102, 255, 1)',
          'rgba(255, 159, 64, 1)',
          '#ffffff'
        ],
        borderWidth: 1
      }
    ]
  }
  return (
    <>
      <Head>
        <title>Pocket Health App</title>
        <meta name='description' content='Pocket Health App' />
        <meta name='viewport' content='width=device-width, initial-scale=1' />
        <link rel='icon' href='/favicon.ico' />
      </Head>
      <main style={{ padding: 25 }}>
        <Grid container spacing={2}>
          {monthNames.map((month, index) => (
            <Grid key={index} item xs={12} sm={12} lg={3}>
              <NextLink legacyBehavior href={`/months/${month}`}>
                <Link style={{ textDecoration: 'none' }}>
                  <Card
                    sx={{
                      backgroundColor: '#DCD7C9'
                    }}
                  >
                    <CardActionArea
                      sx={{
                        display: 'flex',
                        justifyContent: 'center',
                        alignItems: 'center'
                      }}
                    >
                      <CardContent>
                        <Typography
                          sx={{ fontSize: 25, textDecoration: 'none' }}
                          color='black'
                        >
                          {month}
                        </Typography>
                      </CardContent>
                    </CardActionArea>
                  </Card>
                </Link>
              </NextLink>
            </Grid>
          ))}
        </Grid>
        <div
          style={{ width: '500px', height: '500px', backgroundColor: 'black' }}
        >
          <Pie data={data} />
        </div>
      </main>
    </>
  )
}

export default Home
